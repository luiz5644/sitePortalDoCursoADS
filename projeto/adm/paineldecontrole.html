<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de controle</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }
    
     body {
  margin: 0;
  font-family: Arial, sans-serif;
  overflow-x: hidden;
}
:root {
        --fundo-card: rgb(220, 228, 235);
       
        
      }

.header {
  background-color: white;
  width: 100%;
  height: 60px;
  display: flex;
  align-items: center;
  padding: 0 20px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  position: fixed; /* Mantém fixo no topo */
  top: 0;           /* Posiciona no topo da janela */
  z-index: 1000;    /* Garante que fique acima dos outros elementos */
}

      .img-ads >img {
        display: flex;
        align-items: center;
 
        margin-left: 0px;
        height: 32px;
      }

.main {
  display: flex;
  margin-top: 100px; 
}

.sidebar {
  width: 200px;
  background-color:rgb(245, 245, 245);
  height: calc(100vh - 60px); 
  padding: 10px;
  position: fixed;
  top: 60px;
  left: 0;
}

.content {
  flex: 1;
  margin-left: 240px; 
  margin-top: -30px;
  /* padding: 5px; */
}

.sidebar button {
  display: flex;
  align-items: center;
  width: 100%;
  padding: 10px 15px;
  background: none;
  border: none;
  text-align: left;
  cursor: pointer;
  font-size: 16px;
  margin: 5px;
  margin-bottom: 15px;
}
button > img{
  margin-right: 15px;
}
.sidebar > a{
  background-color: #FF4E4E;
  color: white;
  border-radius: 8px;
  margin-top: 140px;
  padding: 16px;
  font-size: 1rem;
  border-radius: 8px;
  cursor: pointer;
  gap: 8px;
  height: 20px;
  width: 170px;

}
.sidebar >.botao-sair{
  height: 50px;

}
.sidebar> .botao-sair:hover{
  background-color: red;
  border-radius: 8px;
}

.sidebar button:hover {
  background-color: var(--fundo-card);
  border-radius: 10px;
  
}

.sidebar button:focus {
  background-color: var(--fundo-card);
  border-radius: 10px;
}

.card {
  background-color: #ffffff;
  padding: 10px;
  border-radius: 8px;
  margin-bottom: 10px;
}


.card-buttons {
    display: flex;
    align-items: end;
    gap: 5px; 
}

.botoes {
    display: flex;
    justify-content: flex-end; /* alinha os botões à direita */
    margin-top: 0px;
}

.beditar {
    background-color: #4CAF50 !important; 
    color: white !important;
    border: none;
    padding: 5px 10px;
    margin-left: 5px;
    border-radius: 3px;
    cursor: pointer;
}

.bexcluir {
    background-color: #f44336 !important; 
    color: white !important;
    border: none;
    padding: 5px 10px;
    margin-left: 5px;
    border-radius: 3px;
    cursor: pointer;
}
.fundo-card{
    background-color: var(--fundo-card);
    padding: 10px;
    border-radius: 10px;
    word-wrap: break-word;
    width: 90%;
}

.top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.top-bar button {
  background-color:var(--fundo-card);
  border: none;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
}

.top-bar a {
  text-decoration: none;
  color: black;
}

.hidden {
  display: none;
}

  </style>
  </head>
  

  <body>
    <div class="header">
      <div class="img-ads">
        <img src="/projeto/imagem/logoads.png" alt="Logo ADS" />
      </div>
    </div>

    <div class="main">
      <div class="sidebar">
        <button onclick="showSection('eventos')"> <img width="30" height="30" src="https://img.icons8.com/windows/32/3053c6/today.png" alt="today"/> Eventos</button>
        <button onclick="showSection('projetos')">  <img width="30" height="30" src="https://img.icons8.com/ios/50/3053c6/project.png" alt="project"/> Projetos</button>
        <button onclick="showSection('professores')"> <img width="30" height="30" src="https://img.icons8.com/ios/50/3053c6/groups.png" alt="groups"/> Professores</button>
        <button onclick="showSection('salas')"> <img width="30" height="30" src="https://img.icons8.com/ios/50/3053c6/university.png" alt="university"/> Salas</button>
        <button onclick="showSection('usuarios')"><img width="30" height="30" src="https://img.icons8.com/small/32/3053c6/user.png" alt="user"/> Usuários</button>

        <a href="http://127.0.0.1:5500/projeto/paginainicial.html" class="botao-sair" style="display: inline-flex; align-items: center; gap: 4px; text-decoration: none; color: inherit;">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out-icon lucide-log-out">
    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
    <polyline points="16 17 21 12 16 7"/>
    <line x1="21" x2="9" y1="12" y2="12"/>
  </svg>
  sair
</a>
      </div>

      

      <div class="content">
        <!-- Eventos -->
        <div id="eventos" class="section hidden">
        <div class="top-bar">
          <button><a href="cadastroevento.html">+ Novo evento</a></button>
        </div>
        <div class="fundo-card" id="lista-eventos">
          
      </div>
      </div>


        <!-- Projetos -->
        <div id="projetos" class="section hidden">
        <div class="top-bar">
          <button><a href="cadastroprojetos.html">Novo projeto +</a></button>
        </div>
        <div class="fundo-card">
   
      </div>
    
      </div>
        <!-- Professores -->
        <div id="professores" class="section hidden">
      <div class="top-bar">
        <button><a href="cadastroprofessor.html">+ Novo professor</a></button>
      </div>
      <div class="fundo-card">
        <div id="lista-professores"></div>
      </div>
    </div>

        <!-- Salas -->
        <div id="salas" class="section hidden">
          <div class="top-bar">
            <button><a href="cadastrosalas.html">+ Nova sala</a></button>
          </div>
          <div class="fundo-card"><div id="lista-salas"></div></div>
        </div>

        <!-- Usuários -->
        <div id="usuarios" class="section hidden">
          <div class="top-bar">
            
          </div>
          <div class="fundo-card"><div id="lista-usuarios"></div></div>
        </div>
      </div>

      <script>

        
  // Alterna entre as seções
  function showSection(sectionId) {
    document.querySelectorAll(".section").forEach((section) => {
      section.classList.add("hidden");
    });
    const section = document.getElementById(sectionId);
    section.classList.remove("hidden");

    if (sectionId === "salas") {
      carregarSalas();
    }
  }
// funções de evento 
async function carregarEventos() {
  try {
    const res = await fetch('http://localhost:3000/eventos');
    const eventos = await res.json();
    const lista = document.querySelector('#eventos .fundo-card');
    lista.innerHTML = '<div id="lista-eventos"></div>'; // limpa e recria

    const container = document.getElementById('lista-eventos');

    eventos.forEach((evento) => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <strong>${evento.nome}</strong><br>
        Data: ${evento.data}<br>
        Sobre: ${evento.sobre || 'sem descrição'}
        <div class="botoes">
        <button class= "beditar" onclick="editarEvento('${evento.id}', '${evento.nome}', '${evento.data}', '${evento.sobre || ''}')">editar</button>
        <button class= "bexcluir"  onclick="excluirEvento ('${evento.id}')">excluir</button>
        </div>
      `;
      container.appendChild(card);
    });
  } catch (err) {
    console.error('Erro ao carregar eventos:', err);
  }
}


async function excluirEvento(id) {
  const confirmar = confirm("Tem certeza que deseja excluir este evento?");
  if (!confirmar) return;

  try {
    const res = await fetch(`http://localhost:3000/eventos/${id}`, {
      method: 'DELETE'
    });

    if (!res.ok) {
      throw new Error('Erro ao excluir evento');
    }

    alert('Evento excluído com sucesso.');
    carregarEventos(); // Atualiza a lista
  } catch (err) {
    console.error('Erro ao excluir evento:', err);
    alert('Erro ao excluir evento.');
  }
}

function editarEvento(id, nomeAtual, dataAtual, sobreAtual) {
  const novoNome = prompt("Editar nome do evento:", nomeAtual);
  const novaData = prompt("Editar data do evento (ex: 20/agosto):", dataAtual);
  const novoSobre = prompt("Editar descrição do evento:", sobreAtual);

  if (novoNome && novaData) {
    fetch(`http://localhost:3000/eventos/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        nome: novoNome.trim(),
        data: novaData.trim(), 
        sobre: novoSobre?.trim() || ""
      })
    })
    .then(res => {
      if (!res.ok) throw new Error("Erro ao editar evento");
      alert("Evento editado com sucesso!");
      carregarEventos();
    })
    .catch(err => alert(err.message));
  }
}

// funções de projeto  
async function carregarProjetos() {
  try {
    const res = await fetch('http://localhost:3000/projetos');
    const projetos = await res.json();
    const lista = document.querySelector('#projetos .fundo-card');
    lista.innerHTML = '<div id="lista-projetos"></div>'; // limpa e recria a div
    // console.log(projetos);

    const container = document.getElementById('lista-projetos');

    projetos.forEach((projeto) => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
  <strong>${projeto.nome}</strong><br>
  Descrição: ${projeto.sobre || 'sem descrição'}
  <div class="botoes">
  <button class= "beditar" onclick="editarProjeto('${projeto.id}', '${projeto.nome}', '${projeto.sobre}', '${projeto.link}')">editar</button>
  <button class= "bexcluir" onclick="excluirProjeto('${projeto.id}')">excluir</button>
  </div>
`;
      container.appendChild(card);
    });
  } catch (err) {
    console.error('Erro ao carregar projetos:', err);
  }
}

async function excluirProjeto(id) {
  const confirmar = confirm("Tem certeza que deseja excluir este projeto?");
  if (!confirmar) return;

  try {
    const res = await fetch(`http://localhost:3000/projetos/${id}`, {
      method: 'DELETE'
    });

    if (!res.ok) {
      throw new Error('Erro ao excluir projeto');
    }

    alert('Projeto excluído com sucesso.');
    carregarProjetos(); // Atualiza a lista
  } catch (err) {
    console.error('Erro ao excluir projeto:', err);
    alert('Erro ao excluir projeto.');
  }
}

function editarProjeto(idProjeto, nomeAtual, sobreAtual, linkAtual) {
  const novoNome = prompt("Editar nome do projeto:", nomeAtual);
  if (novoNome === null) return; // Usuário cancelou

  const novoSobre = prompt("Editar descrição do projeto:", sobreAtual || '');
  const novoLink = prompt("Editar link do projeto:", linkAtual || '');

  fetch(`http://localhost:3000/projetos/${idProjeto}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      nome: novoNome,
      sobre: novoSobre,
      link: novoLink
      // Não enviamos a foto, o backend mantém a existente
    })
  })
  .then(res => {
    if (!res.ok) throw new Error(res.statusText);
    return res.json();
  })
  .then(() => {
    alert("Projeto editado com sucesso!");
    carregarProjetos();
  })
  .catch(err => {
    console.error("Erro ao editar projeto:", err);
    alert("Erro ao editar projeto: " + err.message);
  });
}

// funções de professor 
async function carregarProfessores() {
  try {
    const res = await fetch('http://localhost:3000/professores');
    const professores = await res.json();
    const lista = document.getElementById('lista-professores');
    lista.innerHTML = '';

    professores.forEach((prof) => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <strong>${prof.nome}</strong><br>
        Email: ${prof.email || 'não informado'}<br>
        Matéria: ${prof.materia || 'não informada'}
        <div class="botoes">
        <button class= "beditar"  onclick="editarProfessor('${prof.id}', '${prof.nome}', '${prof.email}', '${prof.materia}')">editar</button>
        <button class= "bexcluir" onclick="excluirProfessor('${prof.id}')">excluir</button>
        </div>
      `;
      lista.appendChild(card);
    });
  } catch (err) {
    console.error('Erro ao carregar professores:', err);
  }
}


async function excluirProfessor(id) {
  const confirmar = confirm("Tem certeza que deseja excluir este professor?");
  if (!confirmar) return;

  try {
    const res = await fetch(`http://localhost:3000/professores/${id}`, {
      method: 'DELETE'
    });

    if (!res.ok) {
      throw new Error('Erro ao excluir professor');
    }

    alert('Professor excluído com sucesso.');
    carregarProfessores(); // Atualiza a lista
  } catch (err) {
    console.error('Erro ao excluir professor:', err);
    alert('Erro ao excluir professor.');
  }
}
function editarProfessor(id, nomeAtual, emailAtual, materiaAtual) {
  const novoNome = prompt("Editar nome do professor:", nomeAtual);
  const novoEmail = prompt("Editar e-mail do professor:", emailAtual);
  const novaMateria = prompt("Editar matéria:", materiaAtual);

  if (novoNome) {
    fetch(`http://localhost:3000/professores/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        nome: novoNome,
        email: novoEmail,
        materia: novaMateria
      })
    })
    .then(res => {
      if (!res.ok) throw new Error("Erro ao editar professor");
      alert("Professor editado com sucesso!");
      carregarProfessores();
    })
    .catch(err => alert(err.message));
  }
}

// funções de sala 
  async function carregarSalas() {
    try {
      const res = await fetch('http://localhost:3000/salas');
      const salas = await res.json();
      const lista = document.getElementById('lista-salas');
      lista.innerHTML = '';

      salas.forEach((sala) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <strong>${sala.nome}</strong> - ${sala.localizacao}
          <div class="botoes">
          <button class= "beditar"  onclick="editarSala('${sala.id || sala._id}', '${sala.nome}', '${sala.localizacao}')">editar</button>
          <button class= "bexcluir"  onclick="excluirSala('${sala.id || sala._id}')">excluir</button>
          </div>
        `;
        lista.appendChild(card);
      });
    } catch (err) {
      console.error('Erro ao carregar salas:', err);
    }
  }

  async function excluirSala(id) {
  const confirmacao = confirm("Tem certeza que deseja excluir esta sala?");
  if (confirmacao) {
    try {
      const res = await fetch(`http://localhost:3000/salas/${id}`, { method: "DELETE" });
      if (res.ok) {
        alert("Sala excluída com sucesso!");
        carregarSalas();
      } else {
        alert("Erro ao excluir sala.");
      }
    } catch (err) {
      console.error("Erro ao excluir sala:", err);
    }
  }
  }

async function editarSala(id, nomeAtual, localAtual, tipoAtual, fotoAtual) {
  // Adicione fotoAtual como parâmetro
  
  const novoNome = prompt("Editar nome da sala:", nomeAtual);
  const novaLocalizacao = prompt("Editar localização:", localAtual);
  const novoTipo = prompt("Editar tipo da sala: (laboratório/outros)", tipoAtual || '');

  if (novoNome !== null && novaLocalizacao !== null) {
    try {
      const response = await fetch(`http://localhost:3000/atualizar-sala/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          nome: novoNome,
          localizacao: novaLocalizacao,
          tipo: novoTipo,
          fotoAtual: fotoAtual // Mantém a foto existente
        })
      });

      if (!response.ok) {
        throw new Error(await response.text());
      }

      alert("Sala atualizada com sucesso!");
      carregarSalas();
    } catch (error) {
      console.error("Erro ao editar sala:", error);
      alert(`Erro ao editar sala: ${error.message}`);
    }
  }
}

// fuções de usuário
  async function carregarUsuarios() {
  try {
    const res = await fetch('http://localhost:3000/usuarios');
    const usuarios = await res.json();
    const lista = document.getElementById('lista-usuarios');
    lista.innerHTML = '';

    usuarios.forEach((usuario) => {
      const card = document.createElement('div');
      card.className = 'card';
      

      card.innerHTML = `
      <strong>${usuario.email}</strong>
      
      <button class= "bexcluir" onclick="excluirUsuario('${usuario.id}')">excluir</button>
    `;
      lista.appendChild(card);
    });
  } catch (err) {
    console.error('Erro ao carregar usuários:', err);
  }
}
function showSection(sectionId) {
  document.querySelectorAll(".section").forEach((section) => {
    section.classList.add("hidden");
  });
  const section = document.getElementById(sectionId);
  section.classList.remove("hidden");

  if (sectionId === "salas") {
    carregarSalas();
  } else if (sectionId === "usuarios") {
    carregarUsuarios();
  }
}
async function excluirUsuario(id) {
  const confirmar = confirm("Tem certeza que deseja excluir este usuário?");
  if (!confirmar) return;

  try {
    const res = await fetch(`http://localhost:3000/usuarios/${id}`, {
      method: 'DELETE'
    });

    if (!res.ok) {
      throw new Error('Erro ao excluir usuário');
    }

    alert('Usuário excluído com sucesso.');
    carregarUsuarios(); // Atualiza a lista
  } catch (err) {
    console.error('Erro ao excluir usuário:', err);
    alert('Erro ao excluir usuário.');
  }
}



  // Exibe a aba de salas assim que a página carregar
  window.addEventListener("DOMContentLoaded", () => {
    showSection("eventos");
    carregarSalas();
    carregarProfessores();
    carregarProjetos();
    carregarEventos();
  });
</script>

  </body>
</html>

